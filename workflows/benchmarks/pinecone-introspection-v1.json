{
  "name": "BENCHMARK - Pinecone Introspection & Manager V1.0",
  "nodes": [
    {
      "id": "webhook-trigger",
      "name": "Webhook: Pinecone Admin API",
      "type": "n8n-nodes-base.webhook",
      "position": [250, 300],
      "webhookId": "benchmark-pinecone-admin",
      "parameters": {
        "httpMethod": "POST",
        "path": "benchmark-pinecone-admin",
        "responseMode": "responseNode"
      }
    },
    {
      "id": "parse-request",
      "name": "Parse Request",
      "type": "n8n-nodes-base.code",
      "position": [450, 300],
      "parameters": {
        "jsCode": "const body = $input.first().json.body || {};\nconst action = body.action || 'index_stats';\n\nconst validActions = [\n  'index_stats',\n  'list_namespaces',\n  'namespace_stats',\n  'list_indexes',\n  'query_vectors',\n  'fetch_vector',\n  'search_similar',\n  'list_vector_ids',\n  'check_dimension',\n  'compare_namespaces',\n  'get_metadata_stats'\n];\n\nif (!validActions.includes(action)) {\n  return [{\n    json: {\n      error: `Invalid action: ${action}`,\n      valid_actions: validActions\n    }\n  }];\n}\n\nreturn [{\n  json: {\n    action,\n    namespace: body.namespace || '',\n    index_name: body.index_name || 'sota-rag',\n    vector_id: body.vector_id || null,\n    query_vector: body.query_vector || null,\n    top_k: body.top_k || 5,\n    filter: body.filter || null,\n    limit: body.limit || 100\n  }\n}];"
      }
    },
    {
      "id": "router",
      "name": "Route by Action",
      "type": "n8n-nodes-base.switch",
      "position": [650, 300],
      "parameters": {
        "rules": {
          "rules": [
            {"value": "index_stats", "output": 0},
            {"value": "list_namespaces", "output": 1},
            {"value": "namespace_stats", "output": 2},
            {"value": "list_indexes", "output": 3},
            {"value": "query_vectors", "output": 4},
            {"value": "fetch_vector", "output": 5},
            {"value": "search_similar", "output": 6},
            {"value": "list_vector_ids", "output": 7},
            {"value": "check_dimension", "output": 8},
            {"value": "compare_namespaces", "output": 9},
            {"value": "get_metadata_stats", "output": 10}
          ]
        }
      }
    },
    {
      "id": "index-stats",
      "name": "Get Index Stats",
      "type": "n8n-nodes-base.httpRequest",
      "position": [850, 50],
      "parameters": {
        "method": "POST",
        "url": "={{ 'https://' + $vars.PINECONE_HOST + '/describe_index_stats' }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "contentType": "json",
        "body": {},
        "options": {}
      },
      "credentials": {
        "httpHeaderAuth": {
          "id": "pinecone-api-key",
          "name": "Pinecone API Key"
        }
      }
    },
    {
      "id": "list-indexes",
      "name": "List All Indexes",
      "type": "n8n-nodes-base.httpRequest",
      "position": [850, 120],
      "parameters": {
        "method": "GET",
        "url": "https://api.pinecone.io/indexes",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "credentials": {
        "httpHeaderAuth": {
          "id": "pinecone-api-key",
          "name": "Pinecone API Key"
        }
      }
    },
    {
      "id": "query-vectors",
      "name": "Query Vectors",
      "type": "n8n-nodes-base.httpRequest",
      "position": [850, 190],
      "parameters": {
        "method": "POST",
        "url": "={{ 'https://' + $vars.PINECONE_HOST + '/query' }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "contentType": "json",
        "body": {
          "namespace": "={{ $json.namespace }}",
          "topK": "={{ $json.top_k }}",
          "filter": "={{ $json.filter ? JSON.parse($json.filter) : {} }}",
          "includeMetadata": true,
          "vector": "={{ $json.query_vector }}"
        }
      },
      "credentials": {
        "httpHeaderAuth": {
          "id": "pinecone-api-key",
          "name": "Pinecone API Key"
        }
      }
    },
    {
      "id": "fetch-vector",
      "name": "Fetch Vector by ID",
      "type": "n8n-nodes-base.httpRequest",
      "position": [850, 260],
      "parameters": {
        "method": "GET",
        "url": "={{ 'https://' + $vars.PINECONE_HOST + '/vectors/fetch?ids=' + $json.vector_id + '&namespace=' + $json.namespace }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "credentials": {
        "httpHeaderAuth": {
          "id": "pinecone-api-key",
          "name": "Pinecone API Key"
        }
      }
    },
    {
      "id": "list-vector-ids",
      "name": "List Vector IDs",
      "type": "n8n-nodes-base.httpRequest",
      "position": [850, 330],
      "parameters": {
        "method": "GET",
        "url": "={{ 'https://' + $vars.PINECONE_HOST + '/vectors/list?namespace=' + $json.namespace + '&limit=' + $json.limit }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "credentials": {
        "httpHeaderAuth": {
          "id": "pinecone-api-key",
          "name": "Pinecone API Key"
        }
      }
    },
    {
      "id": "check-dimension",
      "name": "Check Embedding Dimension",
      "type": "n8n-nodes-base.httpRequest",
      "position": [850, 400],
      "parameters": {
        "method": "GET",
        "url": "https://api.pinecone.io/indexes/{{$json.index_name}}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "credentials": {
        "httpHeaderAuth": {
          "id": "pinecone-api-key",
          "name": "Pinecone API Key"
        }
      }
    },
    {
      "id": "format-response",
      "name": "Format Response",
      "type": "n8n-nodes-base.code",
      "position": [1100, 300],
      "parameters": {
        "jsCode": "const input = $input.first().json;\nconst action = $vars.action || 'unknown';\n\n// Extract relevant info based on action\nlet formatted = {\n  timestamp: new Date().toISOString(),\n  action: action,\n  database: 'pinecone'\n};\n\nif (action === 'index_stats') {\n  formatted = {\n    ...formatted,\n    total_vectors: input.totalVectorCount,\n    dimension: input.dimension,\n    index_fullness: input.indexFullness,\n    namespaces: input.namespaces\n  };\n} else if (action === 'list_indexes') {\n  formatted = {\n    ...formatted,\n    indexes: input.indexes?.map(idx => ({\n      name: idx.name,\n      dimension: idx.dimension,\n      metric: idx.metric,\n      host: idx.host,\n      status: idx.status\n    }))\n  };\n} else if (action === 'check_dimension') {\n  formatted = {\n    ...formatted,\n    index_name: input.name,\n    dimension: input.dimension,\n    metric: input.metric,\n    status: input.status?.ready ? 'ready' : 'not_ready'\n  };\n} else {\n  formatted.data = input;\n}\n\nreturn [{ json: formatted }];"
      }
    },
    {
      "id": "respond",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [1300, 300],
      "parameters": {
        "respondWith": "json",
        "json": "={{ JSON.stringify($json) }}"
      }
    }
  ],
  "connections": {
    "Webhook: Pinecone Admin API": {
      "main": [[{"node": "Parse Request", "type": "main", "index": 0}]]
    },
    "Parse Request": {
      "main": [[{"node": "Route by Action", "type": "main", "index": 0}]]
    },
    "Route by Action": {
      "main": [
        [{"node": "Get Index Stats", "type": "main", "index": 0}],
        [{"node": "Get Index Stats", "type": "main", "index": 0}],
        [{"node": "Get Index Stats", "type": "main", "index": 0}],
        [{"node": "List All Indexes", "type": "main", "index": 0}],
        [{"node": "Query Vectors", "type": "main", "index": 0}],
        [{"node": "Fetch Vector by ID", "type": "main", "index": 0}],
        [{"node": "Query Vectors", "type": "main", "index": 0}],
        [{"node": "List Vector IDs", "type": "main", "index": 0}],
        [{"node": "Check Embedding Dimension", "type": "main", "index": 0}],
        [{"node": "Get Index Stats", "type": "main", "index": 0}],
        [{"node": "Get Index Stats", "type": "main", "index": 0}]
      ]
    },
    "Get Index Stats": {
      "main": [[{"node": "Format Response", "type": "main", "index": 0}]]
    },
    "List All Indexes": {
      "main": [[{"node": "Format Response", "type": "main", "index": 0}]]
    },
    "Query Vectors": {
      "main": [[{"node": "Format Response", "type": "main", "index": 0}]]
    },
    "Fetch Vector by ID": {
      "main": [[{"node": "Format Response", "type": "main", "index": 0}]]
    },
    "List Vector IDs": {
      "main": [[{"node": "Format Response", "type": "main", "index": 0}]]
    },
    "Check Embedding Dimension": {
      "main": [[{"node": "Format Response", "type": "main", "index": 0}]]
    },
    "Format Response": {
      "main": [[{"node": "Respond to Webhook", "type": "main", "index": 0}]]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "tags": [
    {
      "name": "benchmark",
      "color": "#ff0000"
    },
    {
      "name": "pinecone",
      "color": "#00d4aa"
    },
    {
      "name": "admin",
      "color": "#0000ff"
    }
  ]
}
