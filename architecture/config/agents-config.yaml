# Configuration globale des agents Multi-RAG
# Version: 1.0

global:
  log_level: info
  output_dir: ./outputs
  backup_dir: ./backups

orchestrator:
  model: haiku
  max_retries: 3
  timeout_per_agent: 300
  parallel_execution: false
  error_handling: continue_on_non_critical

agents:
  workflow-analyzer:
    model: opus-4.5
    priority: 1
    timeout: 600
    dependencies: []
    mcp_access:
      - github:read
    inputs:
      - "*.json"
      - "docs/best-practices.md"
    outputs:
      - analysis-report.json
      - architecture-recommendations.md

  db-reader:
    model: opus-4.5
    priority: 2
    timeout: 600
    dependencies:
      - workflow-analyzer  # optionnel, peut tourner en parallèle
    mcp_access:
      - pinecone:read
      - neo4j:read
      - supabase:read
    inputs:
      - analysis-report.json
    outputs:
      - db-inventory.json
      - db-corrections.json

  patch-writer:
    model: opus-4.5
    priority: 3
    timeout: 600
    dependencies:
      - workflow-analyzer
      - db-reader
    inputs:
      - analysis-report.json
      - db-inventory.json
      - "*.json"
    outputs:
      - patches/
      - patches-manifest.json
      - patches-summary.md

  patch-applier:
    model: haiku
    priority: 4
    timeout: 300
    dependencies:
      - patch-writer
    python_packages:
      - jsonpatch>=1.33
      - jsonschema>=4.0
    inputs:
      - patches/
      - patches-manifest.json
    outputs:
      - modified-workflows/
      - backups/
      - apply-results.json

  n8n-tester:
    model: opus-4.5
    priority: 5
    timeout: 900  # plus long car exécution de tests
    dependencies:
      - patch-applier
    mcp_access:
      - n8n-enhanced:full
    inputs:
      - modified-workflows/
      - patches/
    outputs:
      - test-results.json
      - ready-workflows.json
      - needs-review.json
      - final-workflows/

mcp_servers:
  pinecone:
    command: npx
    args: ["tsx", "mcp-servers/pinecone-mcp.ts"]
    env:
      PINECONE_API_KEY: "${PINECONE_API_KEY}"
      PINECONE_HOST: "https://n8nultimate-a4mkzmz.svc.aped-4627-b74a.pinecone.io"

  neo4j:
    command: npx
    args: ["tsx", "mcp-servers/neo4j-mcp.ts"]
    env:
      NEO4J_URI: "https://a9a062c3.databases.neo4j.io"
      NEO4J_DATABASE: "neo4j"
      NEO4J_USER: "${NEO4J_USER}"
      NEO4J_PASSWORD: "${NEO4J_PASSWORD}"

  supabase:
    command: npx
    args: ["tsx", "mcp-servers/supabase-mcp.ts"]
    env:
      POSTGRES_CONNECTION_STRING: "postgresql://postgres:${SUPABASE_PASSWORD}@db.ayqviqmxifzmhphiqfmj.supabase.co:5432/postgres"

  n8n-enhanced:
    command: npx
    args: ["tsx", "mcp-servers/n8n-enhanced-mcp.ts"]
    env:
      N8N_HOST: "https://amoret.app.n8n.cloud"
      N8N_API_KEY: "${N8N_API_KEY}"

workflows:
  - name: "TEST - SOTA 2026 - Enrichissement V3.1.json"
    category: enrichment
    priority: high

  - name: "TEST - SOTA 2026 - Feedback V3.1.json"
    category: feedback
    priority: medium

  - name: "TEST - SOTA 2026 - Ingestion V3.1.json"
    category: ingestion
    priority: critical

  - name: "TEST - SOTA 2026 - WF2 Graph RAG V3.3 - CORRECTED (1).json"
    category: rag
    priority: high

  - name: "TEST - SOTA 2026 - WF4 Quantitative V2.0 (1).json"
    category: rag
    priority: medium

  - name: "TEST - SOTA 2026 - WF5 Standard RAG V3.4 - CORRECTED.json"
    category: rag
    priority: high

  - name: "V10.1 orchestrator copy (5).json"
    category: orchestrator
    priority: critical
